<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Content - Hudan Hidayat Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <%- include('head_config') %>
        <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
        <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>

<body class="bg-gray-50 flex h-screen">
    <!-- Sidebar (Same as dashboard) -->
    <%- include('sidebar') %>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-8">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">
                    <%= title %>
                </h1>
                <a href="/admin" class="text-gray-500 hover:text-gray-800">Cancel</a>
            </div>

            <form action="<%= action %>" method="POST" enctype="multipart/form-data"
                class="bg-white p-8 rounded-xl shadow-lg border border-gray-100 max-w-5xl mx-auto">
                <!-- Category (Hidden if creating new for specific section) -->
                <input type="hidden" name="category" value="<%= category %>">

                <!-- Title -->
                <div class="mb-8">
                    <label class="block text-gray-400 text-[10px] uppercase font-bold tracking-widest mb-2">Judul
                        Karya</label>
                    <input type="text" name="title" value="<%= item ? item.title : '' %>"
                        class="w-full px-0 py-2 border-b-2 border-gray-100 text-2xl font-serif focus:outline-none focus:border-red-500 transition-colors placeholder-gray-300"
                        placeholder="Masukkan judul di sini..." required>
                </div>

                <!-- Cover Image -->
                <div class="mb-8">
                    <label class="block text-gray-400 text-[10px] uppercase font-bold tracking-widest mb-2">Gambar
                        Sampul</label>
                    <div
                        class="flex items-center gap-6 p-4 border-2 border-dashed border-gray-100 rounded-lg bg-gray-50/50">
                        <% if (item && item.image_url) { %>
                            <img src="<%= item.image_url %>" alt="Current Image"
                                class="h-20 w-20 object-cover rounded shadow-md">
                            <% } else { %>
                                <div
                                    class="h-20 w-20 bg-gray-200 rounded flex items-center justify-center text-gray-400">
                                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path
                                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                <% } %>
                                    <div class="flex-1">
                                        <input type="file" name="image"
                                            class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100 transition">
                                        <p class="text-[10px] text-gray-400 mt-2 uppercase tracking-tight">Format: JPG,
                                            PNG, WEBP (Maks 2MB)</p>
                                    </div>
                    </div>
                </div>

                <!-- Quill Editor -->
                <div class="mb-10">
                    <label class="block text-gray-400 text-[10px] uppercase font-bold tracking-widest mb-2">Isi
                        Konten</label>
                    <div
                        class="border-2 border-gray-100 rounded-lg overflow-hidden focus-within:border-red-500 transition-colors">
                        <div id="editor" class="min-h-[500px] text-lg leading-relaxed font-serif">
                            <%- item ? item.content : '' %>
                        </div>
                    </div>
                    <!-- Hidden input to store Quill content -->
                    <input type="hidden" name="content" id="content" value="<%= item ? item.content : '' %>">
                </div>

                <div class="flex justify-end gap-4">
                    <button type="submit"
                        class="bg-salihara-red text-white font-bold py-3 px-10 rounded-full hover:bg-red-600 transition shadow-lg shadow-red-200 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                        </svg>
                        Simpan Perubahan
                    </button>
                </div>
            </form>
        </main>

        <script>
            var quill = new Quill('#editor', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        ['blockquote', 'code-block'],
                        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                        ['link', 'image', 'video'],
                        ['clean']
                    ]
                }
            });

            // Set initial content if present (Quill might clear div content on init, so we set it safely)
            // Note: The content inside <div id="editor"> might remain if Quill is config'd right, 
            // but explicitly setting it via API is safer to avoid XSS issues breaking the script if we used JS strings.
            // Since we rendered it into the div, let's see if Quill kept it. 
            // If not, we can pull from the hidden input which we also populated.
            if (document.querySelector('#content').value) {
                quill.root.innerHTML = document.querySelector('#content').value;
            }

            // Sync Quill content to hidden input on submit
            document.querySelector('form').addEventListener('submit', function () {
                document.querySelector('#content').value = quill.root.innerHTML;
            });
        </script>
</body>

</html>